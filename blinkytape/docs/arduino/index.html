<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us" class="no-js">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title> BlinkyTape .. Programming your Blinkytape's firmware </title>
   <meta name="author" content="BlinkyTape" />

	<meta charset="utf-8" />
	<!-- Set the viewport width to device width for mobile -->
	<meta name="viewport" content="width=device-width" /> 

	<!-- Included CSS Files --> 
	<link rel="stylesheet" href="/stylesheets/foundation.css">
	<link rel="stylesheet" href="/stylesheets/app.css"> 
	
	<link href="/javascripts/prettify/prettify.css" type="text/css" rel="stylesheet" /> 

	<link rel="stylesheet" href="/stylesheets/web.css" type="text/css" media="screen, projection" /> 

	<script type="text/javascript" src="/javascripts/lightbox.js"></script>
	
	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-38619168-1']);
	  _gaq.push(['_setDomainName', 'blinkiverse.com']);
	  _gaq.push(['_trackPageview']);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>
  <style>
    body {
    -webkit-transform: rotate(0deg) scale(1);
    -webkit-transition-property: all 2s ease-out;
    }
  </style>
</head> 
<body> 
	
<div class="site"> 
<div class="container">
	
	<div class="row header book"> 
		
  		<div class="four columns">
      <h1 class="logo">	<a href="/" class="hide-on-phones"><img src="/images/blinkinlabs-logo-trans.png" alt="BlinkyTape Logo" title="Blinkinlabs Logo" /></a></h1>
		
			<div class="show-on-phones hide-on-desktops hide-on-tablets main_sidebar main_sidebar_mobile"> 
				<h1 class="logo logo-mobile"><a href="/"><img src="/images/blinkinlabs-logo-trans.png" alt="Blinkinlabs Logo" title="BlinkyTape" /></a></h1>
				
				<div class="eight columns menu menu-mobile">
					<a href="/bio"> About </a>
          <a href="/contact"> Contact Us </a>
        <a href="/forums"> Forums </a>
			  </div>
				
			</div>			

  		</div>
  		<div class="eight columns menu right hide-on-phones" style="padding-top:45px">
        <a href="/bio"> About </a>
	      <a href="/contact"> Contact Us </a>
        <a href="/forums"> Forums </a>
      </div>
	</div>
  
  <div class="row">	
<div class="twelve columns"> 
</div> 
</div>

<div class="row">	
  <div class="twelve columns"> 
    
    <div class="project_full docs"> 
      
      <div class = "qq5">
      <h1>
      Programming your Blinkytape's firmware 
      </h1> 
    
      </div> 
      <p>We're about to do some very exciting stuff -- we're going to put a whole new program right on your Blinkytape. Since this is a pretty small program that runs on a piece of hardware, we're going to call it <em>firmware.</em> If you're not familiar with the term already, you'll probably hear the term again when you're updating the software on a new camera, TV, car, or smart fridge. At the end of the day, it's a program like any other that runs on a tiny computer in the Blinkytape (the Blinkyboard.)</p>

<p>So, in order to make new firmware for your Blinkytape, we're going to install the Arduino environment, followed by a few special libraries.  Then we're going to show you how to get a simple program on there. At that point, you should have the basic knowledge you need to get started on your own, so it'll be time for us to tearfully send you out into the world <em>by yourself.</em></p>

<h2>Install Arduino</h2>

<p>Our first step is to download the Arduino development environment. We made Blinkytape compatible with Arduino because it has a huge community and runs in Windows, Mac OS X, and Linux -- so, chances are good that you'll be able to run it on your computer and also find help if you get stuck anywhere.</p>

<p>The fine folks at Arduino have this covered very well, so head over to the <a href="http://arduino.cc/en/Guide/HomePage">Arduino Getting Started page</a> for detailed install instructions. The installation process is very straightforward and they have <a href="http://arduino.cc/en/Guide/HomePage">good documentation</a> if you have any trouble.</p>

<p>If you're having trouble picking a version, BlinkyTape is known to work with Arduino version 1.0.5.</p>

<h3>A note on drivers</h3>

<p>If you're using Windows, you'll need the drivers for both BlinkyTape and Arduino before you can program your tape this way. Make sure that you install the <a href="/software/patternpaint/">PatternPaint package</a> which includes the Blinkytape driver, and also the drivers for Arduino which are included in the Arduino package. Windows uses two slightly different drivers depending on how the tape identifies itself, but if you have both, you'll be OK in all scenarios.</p>

<h2>Install the BlinkyTape Arduino Libraries</h2>

<p>Our next step is to download and install a couple of things that we've used to make the Blinkytape firmware better. If you don't know what a <em>library</em> is, don't worry -- just think of it as some helper code. We'll download and install these libraries so we can use the example code. Later on, when you're making your own firmware, you'll see how some of these libraries make it easier to program for BlinkyTape.</p>

<p>First install <a href="https://code.google.com/p/fastspi/downloads/list">this</a> -- it's called 'FastSPI_LED2' and it's for talking with LED strips like the one in your BlinkyTape. Grab the latest version, 'RC5' as of this writing.</p>

<p>Then go ahead and grab <a href="https://github.com/Blinkinlabs/BlinkyTape_Arduino">this</a>! This one is called 'BlinkyTape_Arduino' and it's all the stuff we wrote, including our example code.</p>

<h3>Get 'em.</h3>

<p>If you're not a Git expert, the quickest way to get our BlinkyTape_Arduino package is to use the 'Download Zip' button on the right-hand side of the page. The button should look something like this:</p>

<p><img src="/images/blinkytape/big/git_download_zip.png" alt="zip download button" /></p>

<h3>Install 'em.</h3>

<p>The best to install these particular libraries is to unzip them into the your Arduino libraries folder - they way they are named can cause trouble with the <a href="http://arduino.cc/en/Guide/Libraries">automatic method of installing Arduino libraries.</a> Scroll down on that page for detailed info, but you'll basically take the zipfile and extract it into a folder called Documents/Arduino/libraries (or My Documents\Arduino\libraries on Windows.)</p>

<p>If you downloaded them as recommended above, <strong>you'll need to snip off the '-master' part of the name from the subfolder.</strong>  In other words, you want it to look like 'Documents/Arduino/libraries/FastSPI_LED2' not 'Documents/Arduino/libraries/FastSPI_LED2-master' -- otherwise Arduino won't use them. (It doesn't like special characters in libary names.)</p>

<h3>Restart Arduino if it is running.</h3>

<p>You can handle this one on your own!</p>

<h2>Connect your BlinkyTape to your computer</h2>

<p>Using a <a href="http://en.wikipedia.org/wiki/USB#Mini_and_Micro_connectors">micro-USB cable</a>, connect your BlinkyTape to a USB port on your computer. If this is the first time, prepare to be wowed by an epically awesome rainbow.</p>

<h2>Prepare Arduino to Program Your BlinkyTape</h2>

<p>We're going to configure the Arduino environment to put software onto your Blinkytape. This should be pretty easy.</p>

<ol>
<li>Choose <strong>Tools | Board | Arduino Leonardo</strong></li>
<li>Select your BlinkyBoard's serial port in the <strong>Tools | Serial Port </strong> menu. The port will be named something like 'COM2' on Windows, and something like /dev/tty.usbmodemab123 or /dev/cu.usbmodemab123 -- you can choose either one.</li>
</ol>


<h2>Load the default firmware - ColorSwirl.</h2>

<p>Let's just practice to make sure we have this part down.</p>

<ol>
<li>In the menus for Arduino, choose <strong>File | Examples | BlinkyTape_Arduino | ColorSwirl</strong></li>
</ol>


<h2>Program the BlinkyTape</h2>

<p>Press the Upload Button in the upper right hand corner of the Arduino window to program your BlinkyTape. It should look like this:</p>

<p><img src="/images/blinkytape/big/arduino_upload_button.png" alt="Here's the button!" /></p>

<p>If all goes welll, Arduino won't have a message for you, but your BlinkyTape should pause for a few seconds as the program is uploaded.</p>

<p>If that all went well, it should look just like when you first plugged in your BlinkyTape.</p>

<h2>Load the "Hello World" Program in Arduino</h2>

<ul>
<li>Open Arduino</li>
<li>In the menus, choose <strong>Examples | BlinkyTape | HelloBlinky</strong></li>
<li>You should see something like this:
<img src="/images/blinkytape/big/HelloBlinky.png" alt="HelloBlinky loaded in Arduino" /></li>
</ul>


<h2>Make Your Changes!</h2>

<p>HelloBlinky will cycle through the BlinkyTape's primary colors, with a slight gradient that will make it look like the color is fading in from the end of the strip. First, let's change the speed at which it cycles to make it super fast.</p>

<p>Look for this lines:</p>

<pre><code>int waiting_time = 40; //time in ms for color scaling
</code></pre>

<p>Change the value from <code>"40"</code> to say, <code>"4"</code> so that your code looks like this:</p>

<pre><code>int waiting_time = 4; //time in ms for color scaling
</code></pre>

<p>Press the Upload button again, like we did in step 6. This will send your new version of the program to the BlinkyTape. When the upload is complete, the BlinkyTape should be flashing at your new preferred speed!</p>

<h2>Ok, Let's Try Some Bigger Changes!</h2>

<p>OK, so that was super-easy right? Right. Let's try something a bit more fun.</p>

<p>Now let's find the lines where we set the color.  There are three lines that look something like this:</p>

<pre><code>case 0: leds[i] = CRGB(i*3,0,0); break;
</code></pre>

<p>This is a line in a loop that increases that <code>"i"</code> variable, and <code>"i"</code> is going to be the number of the individual LED we're setting. We're giving each LED an RGB value, and we also use that <code>"i"</code> variable to help us set the color. This line will make the LEDs a brighter red at one end than the other.</p>

<p>But let's change each of them so they have a color gradient instead of just brightness. To do that, we need to set two colors in each line. Let's make the first one (and first means <code>"0"</code> since this is a computer!) go blue to red, the second one red to green, and the third green to blue. We'll use that <code>"i"</code> variable that holds the LED number twice now, so instead of just increasing the red one, we're going to use that number to decrease the blue setting at the same time.</p>

<p>For the first one, let's try this:</p>

<pre><code>case 0: leds[i] = CRGB(i*3,0, 180 - (i*3)); break;
</code></pre>

<p>And for the second, let's do:</p>

<pre><code>case 1: leds[i] = CRGB(180 - (i*3),i*3,0); break;
</code></pre>

<p>I think you can figure out what the third one should be. Punch it in, then click that arrow button one more time to put your new, modified program on your Blinkytape, and Wow! That really kicks up the awesome quotient, right? Now, I think you're starting to see the possibilities of this clever little LED strip.</p>

<h2>Compatibility! Or: you might want to keep serialLoop()</h2>

<p>One important note: the above example won't work with other BlinkyTape software like PatternPaint. However, it's very easy to make your custom BlinkyTape firmware compatible with other BlinkyStuff!  All you have to do is to include the function called <code>serialLoop()</code>.</p>

<p>Look for a function that starts with this line:</p>

<pre><code>void serialLoop() {
</code></pre>

<p>Copy the whole function into your custom Arduino Sketch, and then include these lines in your main loop:</p>

<pre><code>if(Serial.available() &gt; 0) {
  serialLoop();
}
</code></pre>

<p>That should do it! Now you can use your own custom firmware with PatternPaint and other BlinkyTape software.</p>

<h2>Special Stuff for Uber-pros</h2>

<p>So, you  might have noticed that we've been asking your BlinkyTape to pretend that it's an Arduino Leonardo. That's totally fine, since we've made sure that all of our software will work when that's the case.  However...there's a little more to the story. There's an additional github repository, <a href="https://github.com/Blinkinlabs/Blinkinlabs32u4_boards">which you can find here,</a> that contains the code to let your BlinkyTape think it's still a Blinkytape.  You shouldn't need to do this, but if you're flashing a BlinkyTape for a friend who runs Windows and doesn't have Arduino installed, you might want to grab these files. Just make a folder called <code>hardware</code> in your documents/Arduino folder and drop the files in there.</p>

<p>There's also some interesting stuff in <a href="https://github.com/Blinkinlabs/BlinkyTape">this Github repository</a> -- this contains the actual ProductionSketch, as well as the physical designs for the PCB boards, in case all of this programming stuff is just a little too virtual for you!</p>

<h2>Next Steps</h2>

<ul>
<li>Learn more about how we're controlling the LEDs - check out FastSPI_LED2 by going to  <strong>File | Examples | FastSPI_LED2 | Fast2Dev</strong></li>
<li>For even more information, check out <a href="https://code.google.com/p/fastspi/wiki/Documentation">their documentation</a>, which includes API reference materials like info on the CRGB color class and methods for setting LED color.</li>
<li>It's a great idea to check out the <a href="http://arduino.cc/en/Reference/HomePage">Arduino Programming Reference</a> if you're not already familiar.</li>
</ul>


<!--- when available add a line about this: Check out the BlinkyTape Hardware Schematics --->


<ul>
<li>When you have a new firmware, share it with everybody!</li>
</ul>


<h2>Troubleshooting</h2>

<p>If the program fails to compile or upload, or the BlinkyTape is not doing what you expected, there could be a number of things to check.</p>

<h3>Compile Errors</h3>

<p>Sometimes, when you try to put your new firmware on your Blinkytape, you'll see something like this:</p>

<p><img src="/images/blinkytape/big/Arduino_compile_fail.png" alt="Image of Compiling Failure" /></p>

<p>This means that there's an issue with compiling your few program. You'll need to fix that before you can put the new firmware on your BlinkyTape. See if you can fix the compile errors -- the Arduino editor will give you some clues, including the line number where it ran into the problem. You'll find that these issues are often very simple, like a missing semicolon at the end of a line, or mismatched brackets. Check the
<a href="http://arduino.cc/en/Reference/HomePage">Arduino programming reference</a>
if you get stuck.</p>

<h3>Upload Errors</h3>

<p>First off, unplug your BlinkyTape, then plug it back in.  If you've made a successful upload in the past, this will almost always take care of the issue.  When it's plugged in, the tape should be playing the last pattern you programmed onto it.</p>

<ul>
<li>Check to make sure that your <strong>Tools | Board</strong> setting is set to <strong>Arduino Leonardo</strong>. (Or <strong>BlinkyTape</strong> if you have the special package installed.)</li>
<li>Check to make sure that your <strong>Tools | Serial Port</strong> setting is set to the right thing.</li>
</ul>


<h3>BlinkyTape Not Acting Right</h3>

<p>¯\(°_o)/¯</p>

<p>Uh oh. This is where it gets fun. If your new program compiles, and you can flash it to your BlinkyTape, but isn't having the desired effect, it's time to rethink your approach. Read through your program again and think out each step. You'll often be able to use logic to figure out what's gone wrong. If all else fails, you can always go back to the original firmware, found at <strong>File | Examples | BlinkyTape_Arduino | ColorSwirl</strong> -- but make sure to save your custom program for later!</p>
 
    </div> 
    
  </div>
</div> 
 

 

</div>


<footer class="row book">
	    <section class="five columns">&nbsp; </section>
	    
	
	    <section class="four columns">
	      <ul class="block-grid three-up">
			<li> 
	      	<iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/follow_button.html?screen_name=BlinkyTape" style="width:220px; height:20px;"></iframe>
			</li>
		
		
		</ul>
		</section> 
		 
	   
	    <section class="seven columns">
	      <p>Last update 2014-03-11 11:44:30 -0400 </p>
	      <p>Created using <a href="http://github.com/mojombo/jekyll">Jekyll</a> & <a href="http://foundation.zurb.com/">Foundation</a></p>
		
		</section> 
		
</footer>
</div>

<!-- container -->



</body>
</html>
